# ğŸš€ í•«ë”œ ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸ - GitHub Actions
name: Update Hotdeals

on:
  schedule:
    # ë§¤ 1ë¶„ë§ˆë‹¤ ì‹¤í–‰ (GitHub Actions ìµœì†Œ ê°„ê²©)
    - cron: '*/1 * * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥
    
jobs:
  update-deals:
    runs-on: ubuntu-latest
    
    steps:
      - name: Fast Update (Ppomppu + Coolenjoy)
        run: |
          echo "âš¡ ê³ ì† í•«ë”œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘ (ë½ë¿Œ + ì¿¨ì•¤ì¡°ì´)..."
          
          # ê³ ì† API í˜¸ì¶œ (ë½ë¿Œë§Œ)
          start_time=$(date +%s%3N)
          response=$(curl -s -w "%{http_code}" "https://hotdeal-nextjs.vercel.app/api/update-deals-fast")
          http_code=$(echo "$response" | tail -n1)
          end_time=$(date +%s%3N)
          duration=$((end_time - start_time))
          
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… ê³ ì† ì—…ë°ì´íŠ¸ ì„±ê³µ! (${duration}ms)"
          else
            echo "âŒ ê³ ì† ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (HTTP $http_code), ì¼ë°˜ ì—…ë°ì´íŠ¸ë¡œ í´ë°±..."
            
            # í´ë°±: ì¼ë°˜ ì—…ë°ì´íŠ¸ API í˜¸ì¶œ
            fallback_response=$(curl -s -w "%{http_code}" "https://hotdeal-nextjs.vercel.app/api/update-deals")
            fallback_code=$(echo "$fallback_response" | tail -n1)
            
            if [ "$fallback_code" -eq 200 ]; then
              echo "âœ… í´ë°± ì—…ë°ì´íŠ¸ ì„±ê³µ!"
            else
              echo "âŒ í´ë°±ë„ ì‹¤íŒ¨ (HTTP $fallback_code)"
              exit 1
            fi
          fi
          
      - name: Ping Main API  
        run: |
          echo "ğŸ“ ë©”ì¸ API ì›Œë°ì—…..."
          curl -s "https://hotdeal-nextjs.vercel.app/api/deals" > /dev/null
          echo "âœ… API ì›Œë°ì—… ì™„ë£Œ!"

      - name: Update Status
        run: |
          echo "ğŸ“Š ì—…ë°ì´íŠ¸ ì™„ë£Œ ì‹œê°„: $(date)"
          echo "ğŸ”— ì‚¬ì´íŠ¸: https://hotdeal-nextjs.vercel.app"